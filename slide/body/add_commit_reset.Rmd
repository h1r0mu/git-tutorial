
# add, commit, reset 

## git status 

異世界に行ったら最初に唱える呪文.

File statusが4つのどの状態にあるかの確認.
 
```{sh, eval=F}
# 準備
cd path/to/workspace
mkdir repo000
cd repo000
```

```{sh, eval=F}
git status 
```

これから何かする度になるべく`git status`しましょう.


---

### 思い出す

<div align="center">
<img src="https://git-scm.com/book/en/v2/images/lifecycle.png" width="650px">
</div>


## git init 

current directoryにgit repositoryを作る

```{sh, eval=F}
git init 
```

## git initをなかったことにする

current directoryからgit repositoryを削除する
! 削除したrepositoryは元に戻せないので注意 

```{sh, eval=F}
rm -R .git
```

## git add 

ファイルをStaged areaに追加する.

- 新規ファイルの場合
    - tracked(gitの追跡対象指定)にする
    - staged(commitに含める対象指定)にする.
- 既存ファイルの場合
    - staged(commitに含める対象指定)にする.

`git add [path ...]`

```{sh, eval=F}
echo "ROW000" > file000
git add file000
```

## git addをなかったことにする 

- 新規ファイルの場合
    - untracked(gitの追跡対象外)にする
    - unstaged(commitに含める対象外)にする.
- 既存ファイルの場合
    - unstaged(commitに含める対象外)にする.

`git reset [--soft | --hard] [<commit>] [path ...]`

```{sh, eval=F}
git reset HEAD file000
```

stage(git add)されたすべてのファイルを対象にしたい場合

```{sh, eval=F}
git reset HEAD
```

## git commit 

staged(git add)されたすべてのファイルのコピーをGit Directoryへ記録する

```{sh, eval=F}
# 準備
git add file000
```

`git commit [--amend] [-m <msg>]` 

```{sh, eval=F}
git commit -m "Added file000."
```

## git commitをなかったことにする

Git Directoryから最後のCommitを削除する

```{sh, eval=F}
# 準備
cp file000 file001
git add file001
git commit -m "Added file001."
```

```{sh, eval=F}
git reset --soft HEAD^ # HEAD^ = 1つ前の親Commit
```

addもなかったことに

```{sh, eval=F}
# 復習
git reset HEAD 
```

commitとaddの2つをまとめてなかったことに

```{sh, eval=F}
git reset HEAD^ 
```

## git commitをなかったことにしたのをなかったことに

```{sh, eval=F}
$ git reflog
e170b24 (HEAD -> master) HEAD@{0}: reset: moving to HEAD^
953913d HEAD@{1}: commit: Added file001. <-- resetするまえのHEADの位置
...
```

```{sh, eval=F}
git reset HEAD@{1} # HEAD@{1} = 1つ前にHEADの指していたcommit
```

## git reset 

<iframe src="https://www.slideshare.net/slideshow/embed_code/key/3BCgttHAboVzqg?startSlide=30" width="595" height="485" frameborder="0" marginwidth="0" marginheight="0" scrolling="no" style="border:1px solid #CCC; border-width:1px; margin-bottom:5px; max-width: 100%;" allowfullscreen> </iframe> <div style="margin-bottom:5px"> <strong> <a href="https://www.slideshare.net/TomohikoHimura/git-22237343" title="やりなおせる Git 入門" target="_blank">やりなおせる Git 入門</a> </strong> from <strong><a href="https://www.slideshare.net/TomohikoHimura" target="_blank">Tomohiko Himura</a></strong> </div>

---

<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 42.8571%;">
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2858%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"></th>
<th class="tableblock halign-left valign-top">HEAD</th>
<th class="tableblock halign-left valign-top">インデックス</th>
<th class="tableblock halign-left valign-top">作業ディレクトリ</th>
<th class="tableblock halign-left valign-top">作業ディレクトリ保護の有無</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Commit Level</strong></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>reset --soft [commit]</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">REF</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">いいえ</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">いいえ</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">はい</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>reset [commit]</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">REF</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">はい</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">いいえ</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">はい</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>reset --hard [commit]</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">REF</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">はい</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">はい</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>いいえ</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>checkout [commit]</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">HEAD</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">はい</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">はい</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">はい</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>File Level</strong></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>reset (commit) [file]</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">いいえ</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">はい</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">いいえ</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">はい</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>checkout (commit) [file]</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">いいえ</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">はい</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">はい</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>いいえ</strong></p></td>
</tr>
</tbody>
</table>

つまり?

`git reset --hard, git checkout <file>` (上表で太字の**いいえ**になっているやつ) するときは気をつけよう.

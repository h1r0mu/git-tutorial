
# Multi branches (branch, checkout, merge, rebase)

## ã“ã®ç« ã§å­¦ã¹ã‚‹ã“ã¨ 

- ä¸€ã¤ã®versionã‹ã‚‰è¤‡æ•°ã®versionã¸åˆ†å²ã™ã‚‹æ–¹æ³•
- åˆ†å²ã—ãŸversionã‚’ä¸€ã¤ã«ã¾ã¨ã‚ã‚‹æ–¹æ³• 
- ã“ã‚Œã‚‰ã‚’ãªã‹ã£ãŸã“ã¨ã«ã™ã‚‹æ–¹æ³• 

## å­¦ã‚“ã ã“ã¨ã‹ã‚‰ã§ãã‚‹ã“ã¨ 

- è¤‡æ•°äººã§ä¸€ã¤ã®Projectã‚’å¤‰æ›´ã™ã‚‹ (Remoteã¨ã®é€£æºãŒMust) 
- ç•°ãªã‚‹Taskã‚’ä¸¦è¡Œã—ã¦é€²ã‚ã‚‹

## git log 

åŸºæœ¬ã®å‘ªæ–‡
Commit treeã‚’è¡¨ç¤ºã™ã‚‹

 `git log --oneline --graph --all`

---

defaultã®`git log`ã¯è¦‹ã«ãã„ã®ã§,ã„ã„æ„Ÿã˜ã§è¡¨ç¤ºã—ã¦ãã‚Œã‚‹[wrapper](https://github.com/takaaki-kasai/git-foresta)ã‚‚ã‚ã‚‹.

```{sh, eval=F}
$ git-foresta --all | less -RSX
99d7024c 2019-02-19 10:31  â—‹ ameono (master) Added file003
2f98c925 2019-02-19 10:31  â— ameono Added file001 and file002.
bf1b31ad 2019-02-19 10:31  â”‚ â—‹ ameono (HEAD) Added gomi.
fb7cc7b0 2019-02-19 10:31  â”‚ â— ameono å†å¸°ã§æ¤œç´¢ã—ã¦ã€Œã‚‚ã—ã‹ã—ã¦ï¼šå†å¸°ã€ã‚’ã‚¯ãƒªãƒƒã‚¯ã™ã‚‹ã¨â€¦ã€‚
469a6426 2019-02-19 10:31  â”‚ â— ameono Added file002.
f8c8773e 2019-02-19 10:31  â”‚ â— ameono Added file001.
                           â”œâ”€â”˜
2312317f 2019-02-19 10:30  â–  ameono Added file000.
```

---

logã®è¡¨ç¤ºã ã‘ã§ãªãCommitã¨ã‹ã‚’ä¾¿åˆ©ã«ã§ãã‚‹Wrapperã‚‚ã‚ã‚‹

[tig](https://github.com/jonas/tig)

---

### æ€ã„å‡ºã™ 

ä¿å­˜ã•ã‚Œã¦ã„ã‚‹Commit (=Version)ã®è¦ªå­é–¢ä¿‚ã‚’è¡¨ã™tree (ä¸€ç•ªé‡è¦).

- Commitã¯directoryã®ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆã«IDã¨ã—ã¦hashå€¤ã‚’æŒ¯ã£ãŸã‚‚ã®.
- Commitã«ã¯è¦ªã¨ãªã‚‹CommitãŒè¨˜éŒ²ã•ã‚Œã¦ã„ã‚‹ (ğŸ‘‰ treeæ§‹é€ )
- 1åº¦ä½œã£ãŸcommitã¯åŸºæœ¬çš„ã«ãªããªã‚‰ãªã„(æ¢ã›ãªãã¯ãªã‚‹ã®ã§æ³¨æ„) 
- Hashå€¤ã ã‘ã§ç®¡ç†ã™ã‚‹ã¨äººé–“ãŒä½¿ã†ã¨ãä¸ä¾¿ãªã®ã§HEADã¨ã‹masterã¿ãŸã„ãªçœ‹æ¿(refs)ã‚’ä½¿ã†
- master, HEAD, branchãªã©ã¯ç‰¹å®šã®Commitã‚’æŒ‡ã—ã¦ã„ã‚‹refsã®åå‰(**é‡è¦**)

<div align="center">
<img src="https://git-scm.com/book/en/v2/images/advance-master.png" width="650px">
</div>


ã“ã‚Œã‹ã‚‰ã‚„ã‚‹ä½œæ¥­ã¯åŸºæœ¬çš„ã«refsã‚’ä½œã£ãŸã‚Šç§»å‹•ã—ãŸã‚Šã™ã‚‹ä½œæ¥­

## git branch

<branch-name>ã¨ã„ã†åå‰ã®æ–°ãŸãªrefsã‚’ä½œã‚Š,<start-point>ã‚’æŒ‡ã™ã‚ˆã†ã«ã™ã‚‹

`git branch [-d|-D] <branch-name> [<start-point>]`

---

### ã‚„ã£ã¦ã¿ã‚‹

```{sh, eval=F}
# æº–å‚™
cd path/to/workspace
mkdir repo005 # æ–°ã—ã„Git repositoeryã‚’ä½œã‚‹
cd repo005
git init
echo "ROW000" > file000
git add file000 
git commit -m "Added file000."
```

---


```{sh, eval=F}
git branch feature/update_file000 master
```

feature/branch000ã¨ã„ã†åå‰ã®refã‚’ä½œã‚‹(æŒ‡ã™å…ˆã¯masterã®æŒ‡ã—ã¦ã„ã‚‹ã¨ã“ã‚)

## git branchã‚’ãªã‹ã£ãŸã“ã¨ã«ã™ã‚‹

branchã‚’å‰Šé™¤ã™ã‚‹.

```{sh, eval=F}
git branch -d feature/update_file000
```

æœªmergeã®branchã¯å‰Šé™¤ã—ã‚ˆã†ã¨ã™ã‚‹ã‚¨ãƒ©ãƒ¼ãŒå‡ºã‚‹(äºŒåº¦ã¨è¦‹ã¤ã‘ã‚‰ã‚Œãªããªã‚‹ãŸã‚)ã®ã§å¼·åˆ¶å‰Šé™¤ã™ã‚‹å¿…è¦ãŒã‚ã‚‹.

å¼·åˆ¶çš„ã«å‰Šé™¤ã™ã‚‹å ´åˆ.
```{sh, eval=F}
git branch -D feature/update_file000
```


## branchã®å‰Šé™¤ã‚’ãªã‹ã£ãŸã“ã¨ã«ã™ã‚‹ 

```{sh, eval=F}
$ git branch -d feature/update_file000
Deleted branch feature/update_file000 (was e170b24). # <-- ã“ã“ã®hashã‚’è¦šãˆã¦ãŠã 
```

```{sh, eval=F}
git checkout e170b24 
git checkout -b feature/update_file000
```

## git checkout

HEADã®æŒ‡ã™å…ˆã‚’<branch> OR <commit>ã«å¤‰ãˆã‚‹.

`git checkout [-b] [<branch>|<commit>]`


---

### ã‚„ã£ã¦ã¿ã‚‹

```{sh, eval=F}
git checkout feature/update_file000
```

HEADã®æŒ‡ã™å…ˆã‚’feature/branch000ã¸å¤‰ãˆã‚‹

branchã®ä½œæˆã¨checkoutã‚’ã„ã£ãºã‚“ã«ã‚„ã‚‹

```{sh, eval=F}
git checkout -b feature/update_file000
```

--- 

### checkoutã§èµ·ã“ã‚‹ã“ã¨

gitã‚’ä½¿ã£ãŸã“ã¨ã®ã‚ã‚‹äººã¯,checkoutã«ä»–ã®æ(branch)ã«ç§»ã‚‹ã¨ã„ã†ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’æŒã£ã¦ã„ã‚‹ã‹ã‚‚ã—ã‚Œãªã„ãŒ,å®Ÿéš›ã«ã¯HEADã®æŒ‡ã™å…ˆã®refsãŒå¤‰ã‚ã‚‹ã ã‘.

ğŸ‘‰ e.g., masterã‚‚developã‚‚åŒã˜Commitã‚’æŒ‡ã—ã¦ã„ãŸã‚‰,ã©ã¡ã‚‰ã«checkoutã—ã¦ã‚‚Working directoryã¯å¤‰åŒ–ã—ãªã„. åŒã˜Commitã‚’masterã¨ã„ã†refsè¶Šã—ã«è¦‹ã‚‹ã‹developã¨ã„ã†refsè¶Šã—ã«è¦‹ã‚‹ã‹ãŒé•ã†ã ã‘.

---

```{sh, eval=F}
git branch testing 
```

<img src="https://git-scm.com/book/en/v2/images/head-to-master.png" width="400px">

```{sh, eval=F}
git checkout testing 
```


<img src="https://git-scm.com/book/en/v2/images/head-to-testing.png" width="400px">

--- 

CLIã§è¦‹ã¦ã¿ã‚‹

```{sh, eval=F}
$ git branch feature/update_file000
$ git log --graph --all
* commit e170b24890ca2685d9414b15f3862a28b16b3828 (HEAD -> master, feature/branch000)
  Author: ameono <4m3on0@gmail.com>
  Date:   Sat Feb 16 21:28:33 2019 +0900

      Added file000.
```

```{sh, eval=F}
$ git checkout feature/update_file000
$ git log --graph --all
* commit e170b24890ca2685d9414b15f3862a28b16b3828 (HEAD -> feature/branch000, master)
  Author: ameono <4m3on0@gmail.com>
  Date:   Sat Feb 16 21:28:33 2019 +0900

      Added file000.
```
HEAD -> ã®æŒ‡ã™å…ˆã«æ³¨ç›®.

---

`<branch>`ã«checkoutã—ãŸçŠ¶æ…‹ã§Commitã™ã‚‹ã¨`<branch>`refsã®ä½ç½®ã¯HEADã«é€£å‹•ã—ã¦ç§»å‹•ã™ã‚‹.


--- 

### Commitã—ã¦ã¿ã‚‹ 

```{sh, eval=F}
echo "ROW001" >> file000
git add file000 
git commit -m "Updated file000 (added the second row)." 
```

masterã¨é•ã†Commitã‚’æŒ‡ã—ã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèª
```{sh, eval=F}
git log --oneline --graph --all
```

---

### branchã‚’å¤‰ãˆã¦å†åº¦commitã—ã¦ã¿ã‚‹ 

```{sh, eval=F}
git checkout master
cat file000 # update_file000ãƒ–ãƒ©ãƒ³ãƒã®å¤‰æ›´ãŒåæ˜ ã•ã‚Œã¦ã„ãªã„ã“ã¨ã‚’ç¢ºèª 
cp file000 file001 
git add file001
git commit -m "Added file001."
```

åˆ†å²ã—ãŸã“ã¨ã‚’ç¢ºèª
```{sh, eval=F}
git log --oneline --graph --all
```

---

ã“ã®ã‚ˆã†ã«ã—ã¦Taskã”ã¨ã«ä½œæ¥­ç’°å¢ƒã‚’åˆ‡ã‚Šåˆ†ã‘ã‚‹ã“ã¨ãŒã§ãã‚‹.

## è©³èª¬ checkout

å³å¯†ã«ã¯,checkoutã®ã‚„ã£ã¦ã„ã‚‹ã“ã¨ã¯,ãŸã HEADã®æŒ‡ã™å…ˆã‚’å¤‰ãˆã‚‹ã®ã¨ã¯å°‘ã—é•ã†.

checkoutã¯ç‰¹å®šã®branch(ã‚‚ã¡ã‚ã‚“commitã§ã‚‚è‰¯ã„)ã‹ã‚‰fileã‚’Working directoryã«å–ã‚Šå‡ºã—ã¦ãã‚‹commandã§ã‚ã‚‹.

---

```{sh, eval=F}
git checkout <commit|branch> <path>
```

ã¨æ›¸ãã“ã¨ã§,ç‰¹å®šã®`<branch>`(or `<commit>`)ã®`<path>`ã«ã‚ã‚‹fileã‚’ç¾åœ¨ã®Working directoryã«æŒã£ã¦ãã‚‹ã“ã¨ãŒã§ãã‚‹.

`<path>`ã‚’çœç•¥ã™ã‚‹ã¨,ãã®`<branch>`ã®å…¨ãƒ•ã‚¡ã‚¤ãƒ«ã‚’Working directoryã«æŒã£ã¦ãã‚‹ã“ã¨ã«ãªã‚‹.

å…¨éƒ¨æŒã£ã¦ããŸã‚‰Working directoryã®ä¸­èº«ã¯,ãã®`<branch>`ã¨å…¨ãåŒã˜ã«ãªã‚‹.

ğŸ‘‰ HEADã‚’ç§»å‹•ã—ãŸã®ã¨åŒã˜.

---

ã“ã®ãŸã‚,æœªcommitã®fileãŒã‚ã‚‹ã¨checkoutã¯å¤±æ•—ã™ã‚‹

(ã¾ã commitã•ã‚Œã¦ã„ãªã„fileãŒcheckoutå…ˆã®fileã§ä¸Šæ›¸ãã•ã‚Œã¦ã—ã¾ã†!).


## git merge 

ä»–ã®branchã¨ä»Šã„ã‚‹branchã‚’çµ±åˆã™ã‚‹commitã‚’ä½œã‚‹

`git merge [<branch>]`

## git merge 

Githubã‚’ä½¿ã†ã®ã§ã‚ã‚Œã°ã“ã®ä½œæ¥­ã¯PRã‚’Mergeã—ãŸã¨ãã«å‹æ‰‹ã«ã‚„ã£ã¦ãã‚Œã‚‹.

Githubã§PRã‚’mergeã™ã‚‹ã¨ãã¯ã“ã‚“ãªæ„Ÿã˜ã®ã“ã¨ã‚’ã—ã¦ã„ã‚‹.

<div align="center">
<img src="./fig/merge.png" width="550px">
</div>

--- 

PRã®Mergeã§å•é¡ŒãŒèµ·ããŸã¨ãã«å¯¾å‡¦ã§ãã‚‹ã‚ˆã†ã«ãªã‚‹ãŸã‚ã«,GithubãŒPRã‚’Mergeã™ã‚‹ã¨ãã®å‹•ä½œã‚’è‡ªåˆ†ã§ã‚„ã£ã¦ã¿ã‚‹.

---

### ã‚„ã£ã¦ã¿ã‚‹

```{sh, eval=F}
git checkout feature/update_file000
git merge master 
```

```{sh, eval=F}
$ git log --oneline --graph --all
*   0b45d32 (HEAD -> feature/update_file000) Merge branch 'master' into feature/update_file000
|\
| * 179a3bc (master) Added file001.
* | cf7cb13 Updated file000 (added the second row).
|/
* e170b24 Added file000.
```

Merge commitãŒã§ãã¦ã„ã‚‹.

--- 

```{sh, eval=F}
git checkout master 
git merge --no-ff feature/update_file000
```

```{sh, eval=F}
$ git log --oneline --graph --all
*   500adbb (HEAD -> master) Merge branch 'feature/update_file000'
|\
| *   0b45d32 (feature/update_file000) Merge branch 'master' into feature/update_file000
| |\
| |/
|/|
* | 179a3bc Added file001.
| * cf7cb13 Updated file000 (added the second row).
|/
* e170b24 Added file000.
```

Merge commitãŒã¾ãŸã§ãã¦ã„ã‚‹.

## git mergeã‚’ãªã‹ã£ãŸã“ã¨ã«ã™ã‚‹ 

```{sh, eval=F}
$ git log --oneline --graph --all
*   500adbb (HEAD -> master) Merge branch 'feature/update_file000'
|\
| *   0b45d32 (feature/update_file000) Merge branch 'master' into feature/update_file000
| |\
| |/
|/|
* | 179a3bc Added file001. # <-- Mergeå‰ã®materã®ä½ç½®
| * cf7cb13 Updated file000 (added the second row). # <-- Mergeå‰ã®feature/update_file000ã®ä½ç½®
|/
* e170b24 Added file000.
```

master tagã¨update_file000 tagã‚’ãã‚Œãã‚ŒMergeå‰ã®ä½ç½®ã«æˆ»ã›ã°è‰¯ã„.

## (Interruption) HEADã«ã¤ã„ã¦ 

(å¾©ç¿’) HEAD^ = 1ã¤å‰ã®è¦ªCommit

Merge commitã¯è¦ªãŒ2ã¤ã„ã‚‹. ã©ã†ã‚„ã£ã¦æŒ‡å®šã™ã‚Œã°?


---

è¦ªãŒ2ã¤ä»¥ä¸Šã‚ã‚‹å ´åˆ `HEAD^N (N=è¦ªã®ç•ªå·)` ã®ã‚ˆã†ã«æŒ‡å®šã§ãã‚‹.

```{sh, eval=F}
$ git show --name-only HEAD^
commit 179a3bce92c28cb9a6ac1ef4d8ff4002c83d2f7d
Author: ameono <4m3on0@gmail.com>
Date:   Sun Feb 17 00:57:33 2019 +0900

    Added file001.

$ git show --name-only HEAD^2
commit 0b45d32e5332152a5a44400d6394344199f4f968 (feature/update_file000)
Merge: cf7cb13 179a3bc
Author: ameono <4m3on0@gmail.com>
Date:   Sun Feb 17 14:51:11 2019 +0900

    Merge branch 'master' into feature/update_file000
```

--- 

HEAD~2ã¨ä¼¼ã¦ã‚‹ã‘ã©,å…¨ç„¶æ„å‘³ãŒé•ã†.

```{sh, eval=F}
$ git show --name-only HEAD~2
commit e170b24890ca2685d9414b15f3862a28b16b3828
Author: ameono <4m3on0@gmail.com>
Date:   Sat Feb 16 21:28:33 2019 +0900

    Added file000.
```

---

### HEADã®è¡¨è¨˜æ³•ã¾ã¨ã‚

<img src="https://backlog.com/ja/git-tutorial/img/post/stepup/capture_stepup1_3_2.png" width="350px">

- HEAD~N = HEADã®Nå€‹å‰ã®è¦ªCommit

- HEAD^N = HEADã®1å€‹å‰ã®è¦ªCommitã®Nç•ªç›®

ex) 1å€‹å‰ã®è¦ªã®2ç•ªã‚ã®è¦ªCommit = HEAD~1^2

- HEAD@{N} = Nå€‹å‰ã«HEADãŒæŒ‡ã—ã¦ã„ãŸCommit

## git mergeã‚’ãªã‹ã£ãŸã“ã¨ã«ã™ã‚‹ (ç¶šã) 

masterã®Mergeã‚’ãªã‹ã£ãŸã“ã¨ã«

```{sh, eval=F}
git reset --hard HEAD^ 
```

```{sh, eval=F}
$ git log --oneline --graph --all
*   0b45d32 (feature/update_file000) Merge branch 'master' into feature/update_file000
|\
| * 179a3bc (HEAD -> master) Added file001.
* | cf7cb13 Updated file000 (added the second row).
|/
* e170b24 Added file000.
```

--- 

update_file000ã®Mergeã‚’ãªã‹ã£ãŸã“ã¨ã«

```{sh, eval=F}
git checkout feature/update_file000
git reset --hard HEAD^ 
```

```{sh, eval=F}
$ git log --oneline --graph --all
* 179a3bc (master) Added file001.
| * cf7cb13 (HEAD -> feature/update_file000) Updated file000 (added the second row).
|/
* e170b24 Added file000.
```

ç°¡å˜ã§ã™ã­?

ä»Šã¾ã§ã®è©±ãŒç†è§£ã§ãã¦ã„ã‚Œã°,mergeã‚’ãªã‹ã£ãŸã“ã¨ã«ã—ãŸã®ã‚’ãªã‹ã£ãŸã“ã¨ã«ã‚‚ã§ãã‚‹ã¯ãš.

## git merge --no-ff ã«ã¤ã„ã¦ 

```{sh, eval=F}
(å¾©ç¿’ Githubã®PR Merge)
git checkout feature/update_file000
git merge master 
git checkout master
git merge --no-ff feature/update_file000 <-- --no-ffã«æ³¨ç›®
```

ã“ã®optionã¯ãªã‚“ãã‚„

---

## ãªã—ã«ã—ã¦ã‚„ã£ã¦ã¿ã‚‹

```{sh, eval=F}
git checkout feature/update_file000
git merge master 
git checkout master
git merge feature/update_file000
```

```{sh, eval=F}
$ git log --oneline --graph --all
*   e6de5fd (HEAD -> master, feature/update_file000) Merge branch 'master' into feature/update_file000
|\
| * 179a3bc Added file001.
* | cf7cb13 Updated file000 (added the second row).
|/
* e170b24 Added file000.
```

2å›Mergeã—ãŸã®ã«Merge commitãŒ1ã¤ã—ã‹ã§ãã¦ã„ãªã„.ã¯?

--- 

ğŸ’¡  å‰ã„äººã«èãã¾ã—ã‚‡ã†(99ãƒšãƒ¼ã‚¸ãã‚‰ã„ã¾ã§èª­ã¿é€²ã‚ã¦ãã ã•ã„)

<iframe src="https://www.slideshare.net/slideshow/embed_code/key/us6QLyLgaRMCyy?startSlide=40" width="595" height="485" frameborder="0" marginwidth="0" marginheight="0" scrolling="no" style="border:1px solid #CCC; border-width:1px; margin-bottom:5px; max-width: 100%;" allowfullscreen> </iframe> <div style="margin-bottom:5px"> <strong> <a href="https://www.slideshare.net/kotas/git-15276118" title="ã“ã‚ããªã„ Git" target="_blank">ã“ã‚ããªã„ Git</a> </strong> from <strong><a href="https://www.slideshare.net/kotas" target="_blank">Kota Saito</a></strong> </div>

## git rebase 

mergeã¨åŒã˜ã‚ˆã†ãªã“ã¨ã‚’ã™ã‚‹commandã«rebaseãŒã‚ã‚‹.é•ã„ã‚’è¦‹ã¾ã—ã‚‡ã†.

ä»–ã®branchã®å…ˆç«¯ã«ä»Šã®branchã®æ ¹æœ¬ã‹ã‚‰å…ˆç«¯ã¾ã§ã®commitã‚’ã¾ã¨ã‚ã¦ç§»æ¤ã™ã‚‹

`git rebase [<branch>]`

`git rebase --continue | --skip | --abort | --quit | `


---

## ã‚„ã£ã¦ã¿ã‚‹

```{sh, eval=F}
# æº–å‚™
git branch -f feature/update_file000 HEAD^2 # Mergeã‚’ãªã‹ã£ãŸã“ã¨ã«
git reset --hard HEAD^
git checkout feature/update_file000
```

---

```{sh, eval=F}
git rebase master
```

```{sh, eval=F}
$ git log --oneline --graph --all
* a336ea3 (HEAD -> feature/update_file000) Added file001.
* cf7cb13 (master) Updated file000 (added the second row).
* e170b24 Added file000.
```

--- 

```{sh, eval=F}
$ git checkout master
$ git rebase feature/update_file000
First, rewinding head to replay your work on top of it...
Fast-forwarded master to feature/update_file000.
```

```{sh, eval=F}
$ git log --oneline --graph --all
* a336ea3 (HEAD -> master, feature/update_file000) Added file001.
* cf7cb13 Updated file000 (added the second row).
* e170b24 Added file000.
```

masterã¨featureã¯çµ±åˆã•ã‚ŒãŸãŒ,Merge commitãŒä¸€å€‹ã‚‚ã§ãã¦ã„ãªã„

---

**merge**: Merge Commitã‚’ä½œã£ã¦2ã¤ã®branchã‚’çµ±åˆã™ã‚‹

**rebase**: 2ã¤ã®branchã®ã©ã¡ã‚‰ã‹ã‚’ã‚‚ã†ç‰‡æ–¹ã®å…ˆç«¯ã«ç§»æ¤ã™ã‚‹ã“ã¨ã§çµ±åˆã™ã‚‹

## git rebaseã‚’ãªã‹ã£ãŸã“ã¨ã«ã™ã‚‹ 

ã¾ãšã¯masterã‚’æˆ»ã™.

```{sh, eval=F}
$ git reset --hard HEAD^ 
* a336ea3 (feature/update_file000) Added file001.
* cf7cb13 (HEAD -> master) Updated file000 (added the second row).
* e170b24 Added file000.
```

--- 

æ¬¡ã«update_file000ã‚’æˆ»ã™


```{sh, eval=F}
$ git reflog
a336ea3 (HEAD -> feature/update_file000) HEAD@{2}: checkout: moving from master to feature/update_file000
cf7cb13 (master) HEAD@{3}: reset: moving to HEAD^
a336ea3 (HEAD -> feature/update_file000) HEAD@{4}: rebase finished: returning to refs/heads/master
a336ea3 (HEAD -> feature/update_file000) HEAD@{5}: rebase: checkout feature/update_file000
cf7cb13 (master) HEAD@{6}: checkout: moving from feature/update_file000 to master
a336ea3 (HEAD -> feature/update_file000) HEAD@{7}: rebase finished: returning to refs/heads/feature/update_file000
a336ea3 (HEAD -> feature/update_file000) HEAD@{8}: rebase: Added file001.
cf7cb13 (master) HEAD@{9}: rebase: checkout master
179a3bc HEAD@{10}: checkout: moving from master to feature/update_file000 # <-- ã“ã‚Œ
```

```{sh, eval=F}
$ git reset --hard HEAD@{10} 
$ git log --oneline --graph --all
* 179a3bc (HEAD -> feature/update_file000) Added file001.
| * cf7cb13 (master) Updated file000 (added the second row).
|/
* e170b24 Added file000.
```

Mergeã‚ˆã‚Šæˆ»ã™ã®ãŒé¢å€’(reflogä½¿ã‚ãªã„ã‹ã‚“)ã§ã™ã­.

ã“ã®ã“ã¨ã‹ã‚‰,rebaseã¨mergeãªã‚‰mergeã‚’ä½¿ã†ã¹ãã¨ã„ã†äººã‚‚ã„ã¾ã™.

---

å…¬å¼æ›°ã,

> å…¬é–‹ãƒªãƒã‚¸ãƒˆãƒªã«ãƒ—ãƒƒã‚·ãƒ¥ã—ãŸã‚³ãƒŸãƒƒãƒˆã‚’ãƒªãƒ™ãƒ¼ã‚¹ã—ã¦ã¯ã„ã‘ãªã„

> ã“ã®æŒ‡é‡ã«å¾“ã£ã¦ã„ã‚‹é™ã‚Šã€ã™ã¹ã¦ã¯ã†ã¾ãé€²ã¿ã¾ã™ã€‚ã‚‚ã—ã“ã‚Œã‚’å®ˆã‚‰ãªã‘ã‚Œã°ã€ã‚ãªãŸã¯å«Œã‚ã‚Œè€…ã¨ãªã‚Šã€å‹äººã‚„å®¶æ—ã‹ã‚‰ã‚‚è»½è”‘ã•ã‚Œã‚‹ã“ã¨ã«ãªã‚‹ã§ã—ã‚‡ã†ã€‚(Pro Git)

## è©³èª¬ rebase

ğŸ’¡  å‰ã„äººã«èãã¾ã—ã‚‡ã†(181ãƒšãƒ¼ã‚¸ãã‚‰ã„ã¾ã§èª­ã¿é€²ã‚ã¦ãã ã•ã„)

<iframe src="https://www.slideshare.net/slideshow/embed_code/key/us6QLyLgaRMCyy?startSlide=100" width="595" height="485" frameborder="0" marginwidth="0" marginheight="0" scrolling="no" style="border:1px solid #CCC; border-width:1px; margin-bottom:5px; max-width: 100%;" allowfullscreen> </iframe> <div style="margin-bottom:5px"> <strong> <a href="https://www.slideshare.net/kotas/git-15276118" title="ã“ã‚ããªã„ Git" target="_blank">ã“ã‚ããªã„ Git</a> </strong> from <strong><a href="https://www.slideshare.net/kotas" target="_blank">Kota Saito</a></strong> </div>

## æ­´å²æ”¹å¤‰ã®rebaseã¨branchã®rebase

æ­´å²æ”¹å¤‰ã®rebase(å·¦)ã¨branchã®rebase(å³)
ã‚„ã£ã¦ã„ã‚‹ã“ã¨ã¯åŒã˜.

<div class="column-left">
<div align="center">
<img src="./fig/rebase_single.svg" width="300px">
</div>
</div>
<div class="column-right">
<div align="center">
<img src="./fig/rebase_multi.svg" width="500px">
</div>
</div>

## git cherry-pick 

ä»–ã®branchã®ç‰¹å®šã®commitã‚’ä»Šã®branchã®å…ˆç«¯ã«ç§»æ¤ã™ã‚‹

`git cherry-pick <commit>...`

---

### ã‚„ã£ã¦ã¿ã‚‹

```{sh, eval=F}
$ git log --oneline --graph --all
* 179a3bc (HEAD -> feature/update_file000) Added file001.
| * cf7cb13 (master) Updated file000 (added the second row).
|/
* e170b24 Added file000.
```

---

```{sh, eval=F}
$ git cherry-pick cf7cb13
```

---

```{sh, eval=F}
$ git log --oneline --graph --all
* 8a1eae4 (HEAD -> feature/update_file000) Updated file000 (added the second row).
* 179a3bc Added file001.
| * cf7cb13 (master) Updated file000 (added the second row).
|/
* e170b24 Added file000.
```

 `master`ã®commitãŒ`feature/update_file000`ã¸copyã•ã‚ŒãŸ

 rebaseã¯cherry-pickã‚’è¤‡æ•°ã¾ã¨ã‚ã¦ã‚„ã£ã¦ã„ã‚‹ã ã‘ã¨ã‚‚è¨€ãˆã‚‹.

## Conflict 

çµ±åˆã™ã‚‹è¤‡æ•°ã®branchã§åŒã˜fileãŒå¤‰æ›´ã•ã‚Œã¦ã„ã‚‹ã¨,CONFLICTãŒèµ·ã“ã‚‹

ã“ã‚Œã¯,GitãŒã©ã¡ã‚‰ã®æ­´å²(Branch)ãŒæ­£ã—ã„ã‹åˆ¤æ–­ã§ããªã„ãŸã‚.

userã¯è‡ªåˆ†ã§æ­£ã—ã„æ­´å²ã‚’é¸æŠã™ã‚‹å¿…è¦ãŒã‚ã‚‹.

---


## Conflictã‚’èµ·ã“ã—ã¦ã¿ã‚‹

```{sh, eval=F}
# æº–å‚™
git reset --hard HEAD^
echo "ROW002 <- update_file000" >> file000 
```

masterã¨featureã®ä¸¡æ–¹ã§file000ãŒç·¨é›†ã•ã‚Œã¦ã„ã‚‹çŠ¶æ…‹ã‚’ä½œã‚Šå‡ºã™.

---

```{sh, eval=F}
$ git merge master
Auto-merging file000
CONFLICT (content): Merge conflict in file000
Automatic merge failed; fix conflicts and then commit the result.
```

ğŸ‰ CONFLCIT!!!

---

Conflictã—ãŸfileã®ä¸­èº«

```{txt, eval=F}
ROW000
<<<<<<< HEAD
ROW002 <- update_file000
=======
ROW001
>>>>>>> master
```

## Conflictã®è§£æ¶ˆæ³• 

1. Confilitã—ãŸãƒ•ã‚¡ã‚¤ãƒ«ã‚’Editerã§ç·¨é›†ã™ã‚‹
1. `git checkout [--theirs|--ours] <paths>` ã‚’ä½¿ã†
1. merge-toolã‚’ä½¿ã† 

## 1. Confilitã—ãŸãƒ•ã‚¡ã‚¤ãƒ«ã‚’Editerã§ç·¨é›†ã™ã‚‹

ãã®ã¾ã‚“ã¾. Vimã¨ã‹ã§ã²ã‚‰ã„ã¦â†“ã“ã‚“ãªæ„Ÿã˜ã«ç·¨é›†ã—ã¦ä¿å­˜,Addã—ã¦Commit

```{txt, eval=F}
ROW000
ROW002 <- update_file000 
```

## 2. checkoutã‚’ä½¿ã†æ–¹æ³• 

```{sh, eval=F}
git checkout --theirs file000
```

```{txt, eval=F}
ROW000
<<<<<<< HEAD # = --ours 
ROW002 <- update_file000 
=======
ROW001
>>>>>>> master # = --theris 
```

mergeå…ƒã®branch(=--theirs)ã®å¤‰æ›´ã‹mergeå…ˆ(=HEAD, --ours)ã®å¤‰æ›´ã‹ã®ã©ã¡ã‚‰ã‹ã‚’æ¡ç”¨ã™ã‚‹.

**åˆ©ç‚¹**: pdfã‚„ç”»åƒãªã©ãƒ†ã‚­ã‚¹ãƒˆã¨ã—ã¦ç·¨é›†ã§ããªã„ã‚‚ã®ãŒConflictã—ãŸã¨ãã«ä¾¿åˆ©

PDFã‚’Vimã§é–‹ã„ã¦ã€Œã“ã®è¡Œã¯mergeå…ˆã‚’æ¡ç”¨ã—ã¦,ã“ã£ã¡ã¯branchã‚’æ¡ç”¨...ã€ã¨ã‹ã‚„ã£ã¦ã‚‹ã‚„ã¤ãŒã„ãŸã‚‰ç—…æ°—...

**æ¬ ç‚¹**: ã©ã†ã„ã†çµæœã«ãªã‚‹ã‹äºˆæƒ³ãŒã¤ãã«ãã„. 


## 3. merge-toolã‚’ä½¿ã† 

merge-toolã«ã¯[è‰²ã€…ã‚ã‚‹](https://japan.blogs.atlassian.com/2016/02/tips-tools-to-solve-git-conflicts/).

```{}
git mergetool --tool=vimdiff
```

<img src="./fig/merge_tool_vimdiff.png" width="650px">

DiffãŒã‚ã‚‹Chunk(=è‰²ãŒå¤‰ã‚ã£ã¦ã„ã‚‹éƒ¨åˆ†)ã«ã‚«ãƒ¼ã‚½ãƒ«ã‚’åˆã‚ã›,
1do, 2do, 3doã¨å…¥åŠ›ã™ã‚‹ã“ã¨ã§,ãã‚Œãã‚Œä¸Šæ®µã®å·¦ã‹ã‚‰1ç•ªç›®,2ç•ªç›®,3ç•ªç›®ãŒä»Šå¾Œã®å§¿ã«å–ã‚Šè¾¼ã¾ã‚Œã‚‹.

--- 

PyCharmã®ã‚ˆã†ã«Conflictã‚’è§£æ¶ˆã™ã‚‹ãƒ„ãƒ¼ãƒ«ãŒä»˜ã„ã¦ã„ã‚‹IDEã‚‚ã‚ã‚‹.

<img src="https://www.jetbrains.com/help/img/idea/2018.3/resolveConflict.png" width="850px">


---

Conflictã‚’è§£æ¶ˆã—ãŸã‚‰å½“è©²ã®fileã‚’addã—ã¦commit.

```{sh, eval=F}
git add file000
git commit  
```

â—Conflictè§£æ¶ˆã®ã¨ãã¯è‡ªå‹•çš„ã«messageãŒå…¥åŠ›ã•ã‚Œã‚‹ã®ã§mã‚ªãƒ—ã‚·ãƒ§ãƒ³ã¯ã„ã‚‰ãªã„

æˆåŠŸã™ã‚Œã°Merge(or rebase, cherry-pickãªã©)ãŒå®Œäº†ã™ã‚‹.


## Githubってなんだよ

GitHub は世界最大の Remote Git リポジトリホスティングサービスだよ.

つまり?

**localのrepository = localのPCにおいてあるdirecotry**

とすると,

**Github上のrepository = Google driveにおいてあるdirecotry**

のような関係.

---

有名どころ 

- Github

- Gitlab

- Bitbucket

Githubがやたら有名だが他にもある (Google driveとDropbox的な関係).

できることは大差ないので,お財布事情とUIの好みの問題

(あとは狸と猫のどっちが好きかとか...バケツ...).


<div align="center">
<img src="http://www-creators.com/wp-content/uploads/2017/02/SERVICES-680x220.png" width="750px">
</div>

---

### Github

- とにかく有名 (連携サービスが多いイメージ).

- お金たくさん持ってく.

- [Github Education](https://education.github.com/)とか言う学生プランに加入するとGithub含め色々な有名サービスが無料で使える.

- 本田圭佑がいる

- 他の2つと違い自前のCIとかはない(他のツールと組み合わせる前提OSSの思想的には○?)

---

### Gitlab

- どちらかというと,自組織のサーバにインストールして自分たちしかアクセスできないRemote repositoryとして使う (要するに自前のfile server的なやつ)オンプレミス版のほうが有名.


- Slackを水で薄めたようなchatアプリやCIがついてくるので,これひとつで開発に必要なすべての作業を完結させることができる.

- 大人の事情でPublic臭の強いGithubとかSlackとかを使えない人たちが使ってるっぽい(NASAとか).


---

### Bitbucket 

- 一昔前までPrivate repository(外部公開されない) 作り放題な唯一のサービスだったので,個人の利用者が多くいた(今は,Githubも作り放題).

- Source treeの開発元でもあるAtlassianの製品.

- お金ないらしい(最近値上げした).

---

### 比較

https://stackshare.io/stackups/bitbucket-vs-github-vs-gitlab

2019 2月現在,各サービスの無料プランの状況

                       Github    Bitbucket   Github (学生)   Bitbucket (学生)   GitLab
  -------------------- --------- ----------- --------------- ------------------ -----------
  private repository   無制限    無制限      無制限          無制限             無制限
  public repository    無制限    無制限      無制限          無制限             無制限
  collaborator         3名まで   5名まで     無制限          無制限             無制限
  CI build time        \-        50分/月     \-              500分/月           2000分/月
  LFS                  1GB       1GB         1GB             5GB                無制限?
  LFS Bandwidth        1GB/月    無制限      1GB/月          無制限             無制限?

## git clone

remote repositoryのcopyをlocalに作る.(= ダウンロード)

`git clone <repository>`

<div align="center">
<img src="./fig/clone.svg" width="750px">
</div>

## git fetch

remote repository(のタグとcommit)を同期する

<div align="center">
<img src="./fig/fetch.svg" width="750px">
</div>

## git fetch

このままではremoteのmaster(origin/master)がlocalのmasterに反映されていないので,masterをorigin/masterにmergeする.

```{sh, eval=F}
git merge origin master
```

<div align="center">
<img src="./fig/merge_after_fetch.svg" width="750px">
</div>


## git pull

`git pull [--rebase|--no-ff] <remote> <branch>`

`git fetch` と `git merge origin/master` をまとめてやる(`--rebase`つけると`git rebase origin/master`になる)

<div align="center">
<img src="./fig/pull.svg" width="700px">
</div>

Mergeの作業が入っているため,pullではConflictが発生する可能性がある.

PRという名前はGithubのPRのMergeにpull(fetch+merge)コマンドが含まれることに由来する

## git push

`git push <remote> <branch>`

remoteの`<branch>`タグをlocalの`<branch>`タグの位置に同期させる(Conflictする場合はpushできない).

<div align="center">
<img src="./fig/push.svg" width="750px">
</div>

---

Tips: git pushはgit pullのremoteとlocalを入れ替えたもの

つまり,**remote**から**local**を

`git pull --ff-only <branch>`

したときに起こる動作と同じと考えることができる.

`--ff-only`勉強しといてよかったね!!!?


## git pushできないとき 

--ff-only オプションのせいでConflictするとpushはできない

この場合の解決方法:

- -f(force) オプションを使う
    - 強制的にremoteを上書きする(危険)
		- ミスるとremoteからすべての歴史を吹き飛ばすので注意してやること(頭真っ白になる)
		- とはいえrebaseやamendすると-f使う以外にpushする方法はなくなるので避けることはできない
		- このオプションを使ってよいのは,最悪吹き飛ばしてもなんとかなるfeature branchのみ
- --force-with-leaseを使う
    - ローカルが最新の場合のみ強制的にremoteを上書きする
- pullしてConflictを解消する 
    - 自分の実行したrebaseやamend以外の原因(remoteが他の誰かの手によって更新されたことによるConflict)の場合,pullしてConflictを解消することで解決する(pullはconflictが起こっても実行できるため)

## git fetch VS git pull

- 他のbranchにcheckoutせずにremoteのCommitを取り込みたい場合fetch
- それ以外の場合pull

最新のmasterにfeatureをrebaseしたい場合の例

```{sh, eval=F}
# pull version (HEAD -> feature)
git checkout master
git pull origin master
git checkout feature
git rebase master
```

```{sh, eval=F}
# fetch version (HEAD -> feature)
git fetch origin 
git rebase origin/master 
```

は?

特に,HEADに未commitのfileがあるときにこれをやりたくなるとpullでは非常に面倒(stashを使えばいいのだが更に2コマンド増える)

## Git Flow

branchをどのように切るか(branch戦略)を決めるstyleの一つ.

別に守らなくてもErrorは起きないが,守ると便利なルール(Coding styleとかと同じ立ち位置).

---

<div class="column-right">
<div align="center">
<img src="https://camo.qiitausercontent.com/bbb6ba70f058f0d10c8f7a769ae8fd089dc7684e/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f35333330392f30363134303132312d613062362d343237662d633134392d3638353863313439373338652e706e67" width="450px">
</div>
</div>

<div class="column-left">
- **feature**: 
  - 作業用branch
  - Issueをassignされた人が好きにして良い
  - Issueと対応しているとbetter
- **master**:
  - relase専用のbranch
  - ここに直接CommitしたりfeatureをMergeすることはない
- **develop**:
  - feature branchをmergeする専用のbranch
  - ここに直接commitすることはない 
- **(hotfixes)**:
  - masterに緊急のbugが見つかったときに修正のcommitをするbranch
- **(release)**:
  - masterにmergeする直前の作業をするbranch
</div>


## Github Flow

<div align="center">
<img src="https://cdn-images-1.medium.com/max/2600/1*iHPPa72N11sBI_JSDEGxEA.png" width="850px">
</div>

featureとmasterしかないシンプルなFlow.

面倒なことはPR上でやる.

## Gitlab flow

<div class="column-right">
<div align="center">
<img src="https://camo.qiitausercontent.com/0845268343ff051296a5677ff0ac0a22afac168b/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3138353338392f36386235613237622d653332622d643631662d363032302d3936646533626131643333352e706e67" width="450px">
</div>
</div>

<div class="column-left">
- **feature/hotfix**: 機能開発、不具合対応branch
- **master**: mainのbranch
- **pre-production(option)**: release前のtest用(git-flowで言うrelease branch)
- **production**: release済みのcode置き場
</div>

## 原稿執筆に利用する場合

正解はないので,その都度最適な戦略を考えて選択するべきだが,一例として以下のようなものを提案しておく.

- **feature**: 原稿の執筆を行う
- **develop (master)**: featureのMerge用(Introを書き終えたとかのタイミングでMergeしていくイメージ)
- **master (production)**: 研究会, 国際会議とかの完成版原稿をおいておく

1つの研究の原稿は同じRepositoryで管理し,研究会->国際会議->修論などのようにVersionアップするたびにreleaseしていくといいんじゃない?

